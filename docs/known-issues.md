# Known Issues

## Double Precision Issues in JSON parsing

### Issue

MySQL's JSON parser exhibits different rounding behavior when parsing JSON numbers.

```
mysql> SELECT CAST('2.22507e-308' AS DOUBLE);
+--------------------------------+
| CAST('2.22507e-308' AS DOUBLE) |
+--------------------------------+
|                   2.22507e-308 |
+--------------------------------+
1 row in set (0.000 sec)

mysql> SELECT CAST(CAST('2.22507e-308' AS JSON) AS DOUBLE);
+----------------------------------------------+
| CAST(CAST('2.22507e-308' AS JSON) AS DOUBLE) |
+----------------------------------------------+
|                      2.2250700000000003e-308 |
+----------------------------------------------+
1 row in set (0.000 sec)
```

The latter should be `2.22507e-308` but instead becomes `2.2250700000000003e-308`.

NOTE: This only affects JSON *parsing*. Creating a JSON value directly from DOUBLE (.e.g `CAST(CAST(2.22507e-308 AS DOUBLE) AS JSON)`) or just storing DOUBLE values in JSON (unless it is converted to TEXT) doesn't lose precision.

### Impact

Our ProtoJSON parsing relies on MySQL's JSON parser, so this precision issue affects our ability to accurately parse and serialize double values in JSON input.

* `{type}_from_json()` - a JSON parsing function that is generated by protoc-gen-mysql.
* `pb_json_to_message()` - a function to convert ProtoJSON to protobuf binary.

Also, this issue accounts for several conformance test failures involving extreme double values in JSON input:

- `Required.Proto2.JsonInput.DoubleFieldMaxNegativeValue.*`
- `Required.Proto2.JsonInput.DoubleFieldMinPositiveValue.*`
- `Required.Proto2.JsonInput.DoubleFieldQuotedExponentialValue.*`
- `Required.Proto3.JsonInput.DoubleFieldMaxNegativeValue.*`
- `Required.Proto3.JsonInput.DoubleFieldMinPositiveValue.*`
- `Required.Proto3.JsonInput.DoubleFieldQuotedExponentialValue.*`

### Workaround

None. Avoid JSON round-trip when float/double precision is important.

## MySQL Stored Program Cache Bug

**Issue**: When many stored functions are used in a single connection and the `stored_program_cache` limit is reached, MySQL exhibits unpredictable behavior:

- **MySQL 9.3.0**: Functions silently return `NULL` instead of the expected result
- **MySQL 8.0.x**: Functions fail with `Function does not exist` error

**Root Cause**: [MySQL Bug #95825](https://bugs.mysql.com/bug.php?id=95825)

**Workaround**: Increase the stored program cache size:
```sql
SET GLOBAL stored_program_cache = 1024;  -- Default is 256
```

**Impact**:
- Most applications won't encounter this issue as the default cache size (256) is sufficient for typical usage
- This primarily affects comprehensive test suites or applications using many different protobuf functions in a single connection
- Related discussion: [Percona Forums](https://forums.percona.com/t/intermittent-stored-function-does-not-exist-problem/5143)